{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
  <h2 class="fw-bold">Filtra los Zapatos</h2>

  <form method="post" action="{% url 'ver_stock' %}">
    {% csrf_token %}
    <h4 class="mt-4">Selecciona las opciones:</h4>
    
    <!-- Referencia -->
    <div class="form-group mt-4">
      <label for="referencia">Referencias</label>
      <select name="referencia" id="referencia" class="form-control">
        <option value="">Seleccione una referencia</option>
        {% for referencia in referencias %}
          <option value="{{ referencia }}" {% if referencia_sel == referencia %}selected{% endif %}>
            {{ referencia }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Modelo -->
    <div class="form-group mt-4">
      <label for="modelo">Modelos</label>
      <select name="modelo" id="modelo" class="form-control">
        <option value="">Seleccione un modelo</option>
        {% for modelo in modelos %}
          <option value="{{ modelo }}" {% if modelo_sel == modelo %}selected{% endif %}>
            {{ modelo }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Talla -->
    <div class="form-group mt-4">
      <label for="talla">Tallas</label>
      <select name="talla" id="talla" class="form-control">
        <option value="">Seleccione una talla</option>
        {% for talla in tallas %}
          <option value="{{ talla }}" {% if talla_sel|stringformat:"s" == talla|stringformat:"s" %}selected{% endif %}>
            {{ talla }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Color -->
    <div class="form-group mt-4">
      <label for="color">Colores</label>
      <select name="color" id="color" class="form-control">
        <option value="">Seleccione un color</option>
        {% for color in colores %}
          <option value="{{ color }}" {% if color_sel == color %}selected{% endif %}>
            {{ color }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Sexo -->
    <div class="form-group mt-4">
      <label>Sexo:</label><br>
      <label class="me-3">
        <input type="checkbox" name="sexo" value="H" {% if "H" in sexo_sel %}checked{% endif %}> Hombre
      </label>
      <label>
        <input type="checkbox" name="sexo" value="M" {% if "M" in sexo_sel %}checked{% endif %}> Mujer
      </label>
    </div>

    <!-- Estado -->
    <div class="form-group mt-4">
      <label>Estado:</label><br>
      <label class="me-3">
        <input type="checkbox" name="estado" value="Pendientes" {% if "Pendientes" in estado_sel %}checked{% endif %}> Pendientes
      </label>
      <label class="me-3">
        <input type="checkbox" name="estado" value="Producción" {% if "Producción" in estado_sel %}checked{% endif %}> En Producción
      </label>
      <label class="me-3">
        <input type="checkbox" name="estado" value="Anulado" {% if "Anulado" in estado_sel %}checked{% endif %}> Anulado
      </label>
      <label class="me-3">
        <input type="checkbox" name="estado" value="Completado" {% if "Completado" in estado_sel %}checked{% endif %}> Completado
      </label>
      <label class="me-3">
        <input type="checkbox" name="estado" value="Entregado" {% if "Entregado" in estado_sel %}checked{% endif %}> Entregado
      </label>
      <label>
        <input type="checkbox" name="estado" value="Bodega" {% if "Bodega" in estado_sel %}checked{% endif %}> En Bodega
      </label>
    </div>

    <button type="submit" class="btn btn-primary mt-3">Filtrar</button>
    <span class="badge bg-info text-dark ms-3" style="font-size: 1.1em; vertical-align: middle;">
      Número Total de Zapatos: {{ total }}
    </span>
  </form>

  <table class="table table-striped mt-4">
    <thead>
      <tr>
        <th>#</th>
        <th>Modelo</th>
        <th>Referencia</th>
        <th>Talla</th>
        <th>Color</th>
        <th>Sexo</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody>
      {% for zapato in zapatos %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ zapato.modelo }}</td>
        <td>{{ zapato.referencia }}</td>
        <td>{{ zapato.talla }}</td>
        <td>{{ zapato.color }}</td>
        <td>{{ zapato.get_sexo_display|default:zapato.sexo }}</td>
        <td>{{ zapato.estado }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="text-center">No hay resultados para los filtros seleccionados.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="text-center mt-4">
    <a href="{% url 'landing' %}" class="btn btn-secondary">Volver al inicio</a>
  </div>
</div>
{% endblock %}
